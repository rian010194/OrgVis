<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JumpYard Organization Chart</title>
    <link rel="stylesheet" href="css/style.css?v=20241220m">
</head>
<body>
  <header>
  </header>

  <div class="app-toolbar" role="toolbar" aria-label="View and admin controls">
    <div class="toolbar-group">
      <div class="view-dropdown">
        <button type="button" id="viewDropdownToggle" class="view-dropdown-toggle" aria-haspopup="true" aria-expanded="false">
          <span class="view-current">Tree View</span>
          <span class="dropdown-arrow">‚ñº</span>
        </button>
        <div class="view-dropdown-menu" id="viewDropdownMenu">
          <button type="button" data-view="tree" class="view-option active" aria-selected="true">
            <span class="view-icon">üå≥</span>
            <span class="view-label">Tree View</span>
          </button>
          <button type="button" data-view="map" class="view-option" aria-selected="false">
            <span class="view-icon">üó∫Ô∏è</span>
            <span class="view-label">Map View</span>
          </button>
        </div>
      </div>
    </div>
    <button id="toggleAdmin" type="button" class="admin-toggle" aria-pressed="false" aria-controls="adminPanel">
      <span class="admin-icon">‚öôÔ∏è</span>
      <span class="admin-text">Admin</span>
    </button>
  </div>

  <main class="app-layout">
    <section class="org-section">
      <div id="appStatus" class="app-status"></div>
      <div id="orgchart" class="tree-container"></div>
      <div id="mapView" class="map-view hidden"></div>
    </section>

    <aside class="side-section">
      <div id="detailPanel" class="detail-panel"></div>
      <div id="adminPanel" class="admin-panel">
        <div class="admin-tabs" role="tablist" aria-label="Admin views">
          <button type="button" class="admin-tab" id="adminTab-create" data-admin-tab="create" role="tab" aria-selected="false" tabindex="-1" aria-controls="adminPanel-create">Create Node</button>
          <button type="button" class="admin-tab" id="adminTab-edit" data-admin-tab="edit" role="tab" aria-selected="true" tabindex="0" aria-controls="adminPanel-edit">Edit Node</button>
          <button type="button" class="admin-tab" id="adminTab-relations" data-admin-tab="relations" role="tab" aria-selected="false" tabindex="-1" aria-controls="adminPanel-relations">Relations</button>
          <button type="button" class="admin-tab" id="adminTab-metrics" data-admin-tab="metrics" role="tab" aria-selected="false" tabindex="-1" aria-controls="adminPanel-metrics">Metrics</button>
        </div>
        <p class="admin-hint">Changes are automatically saved to your browser. API connection will be added later.</p>
        <div id="adminMessage" class="admin-message"></div>
        <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <button type="button" id="clearDataButton" class="secondary" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Reset to Original Data</button>
          <button type="button" id="testStorageButton" class="secondary" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Test localStorage</button>
        </div>

        <div class="admin-tab-panels">
          <div class="admin-tab-panel" id="adminPanel-create" data-admin-panel="create" role="tabpanel" aria-labelledby="adminTab-create" hidden>
            <form id="adminCreateForm" class="admin-form">
              <h3>Create New Node</h3>
              <label>
                ID
                <input name="id" type="text" required placeholder="e.g. new_node" />
              </label>
              <label>
                Name
                <input name="name" type="text" required placeholder="Node name" />
              </label>
              <label>
                Type
                <select name="type" id="adminCreateType">
                  <option value="Unit">Unit</option>
                  <option value="Group">Group</option>
                  <option value="Department">Department</option>
                  <option value="Individual">Individual</option>
                  <option value="Cluster">Cluster</option>
                  <option value="PO">PO</option>
                  <option value="PA">PA</option>
                  <option value="SupportOffice">SupportOffice</option>
                </select>
              </label>
              <label>
                Parent
                <select name="parent" id="adminCreateParent"></select>
              </label>
              <label>
                Support Office (ID)
                <input name="supportOffice" id="adminCreateSupportOffice" type="text" placeholder="e.g. support_office_iberia" />
              </label>
              <label>
                Role Description
                <textarea name="role" rows="3" placeholder="Describe the node's mission"></textarea>
              </label>
              <label>
                Responsibilities (one point per line)
                <textarea name="responsibilities" id="adminCreateResponsibilities" rows="3" placeholder="One point per line"></textarea>
              </label>
              <label>
                Outcomes (deliverables)
                <textarea name="outcomes" id="adminCreateOutcomes" rows="3" placeholder="One point per line"></textarea>
              </label>
              <button type="submit" class="primary">Create Node</button>
            </form>
          </div>

          <div class="admin-tab-panel" id="adminPanel-edit" data-admin-panel="edit" role="tabpanel" aria-labelledby="adminTab-edit">
            <form id="adminEditForm" class="admin-form">
              <h3>Edit Node</h3>
              <label>
                Select Node
                <select name="nodeId" id="adminEditNodeSelect"></select>
              </label>
              <label>
                Name
                <input name="name" type="text" placeholder="Name" />
              </label>
              <label>
                Type
                <select name="type" id="adminEditType">
                  <option value="Unit">Unit</option>
                  <option value="Group">Group</option>
                  <option value="Department">Department</option>
                  <option value="Individual">Individual</option>
                  <option value="Cluster">Cluster</option>
                  <option value="PO">PO</option>
                  <option value="PA">PA</option>
                  <option value="SupportOffice">SupportOffice</option>
                </select>
              </label>
              <label>
                Parent
                <select name="parent" id="adminEditParent"></select>
              </label>
              <label>
                Support Office (ID)
                <input name="supportOffice" id="adminEditSupportOffice" type="text" placeholder="Connected support office" />
              </label>
              <label>
                Role Description
                <textarea name="role" rows="3" placeholder="Description"></textarea>
              </label>
              <label>
                Responsibilities (one point per line)
                <textarea name="responsibilities" id="adminEditResponsibilities" rows="3" placeholder="One point per line"></textarea>
              </label>
              <label>
                Outcomes (deliverables)
                <textarea name="outcomes" id="adminEditOutcomes" rows="3" placeholder="One point per line"></textarea>
              </label>
              <div class="admin-actions">
                <button type="submit" class="primary">Save Changes</button>
                <button type="button" id="adminDeleteNodeButton" class="danger">Delete Node</button>
              </div>
            </form>
          </div>

          <div class="admin-tab-panel" id="adminPanel-relations" data-admin-panel="relations" role="tabpanel" aria-labelledby="adminTab-relations" hidden>
            <form id="adminAddRelationForm" class="admin-form horizontal">
              <h3>New Relation</h3>
              <div class="horizontal-row">
                <label>
                  From
                  <select name="from"></select>
                </label>
                <span class="arrow">&rarr;</span>
                <label>
                  To
                  <select name="to"></select>
                </label>
              </div>
              <label>
                Description
                <input name="desc" type="text" placeholder="What is delivered?" />
              </label>
              <button type="submit" class="primary">Add Relation</button>
            </form>

            <form id="adminRemoveRelationForm" class="admin-form horizontal">
              <h3>Remove Relation</h3>
              <div class="horizontal-row">
                <label>
                  From
                  <select name="from"></select>
                </label>
                <span class="arrow">&rarr;</span>
                <label>
                  To
                  <select name="to"></select>
                </label>
              </div>
              <button type="submit" class="danger">Remove Relation</button>
            </form>
          </div>

          <div class="admin-tab-panel" id="adminPanel-metrics" data-admin-panel="metrics" role="tabpanel" aria-labelledby="adminTab-metrics" hidden>
            <form id="adminAddMetricForm" class="admin-form">
              <h3>Add Metric</h3>
              <label>
                Node
                <select name="nodeId" required>
                  <option value="">Select a node...</option>
                </select>
              </label>
              <label>
                Metric Name
                <input name="metricName" type="text" placeholder="e.g., Budget, Headcount, Revenue" required />
              </label>
              <div id="valuesContainer" style="display: none;">
                <label>Data Points</label>
                <div id="valuesList">
                  <!-- Dynamic value inputs will be added here -->
                </div>
                <button type="button" id="addValueBtn" class="secondary" style="margin-top: 0.5rem; font-size: 0.9rem;">
                  + Add Data Point
                </button>
              </div>
              <label>
                Unit
                <input name="metricUnit" type="text" placeholder="e.g., SEK, people, %" />
              </label>
              <label>
                Chart Type
                <select name="metricChartType" required>
                  <option value="">Select chart type...</option>
                  <option value="pie">Pie Chart</option>
                  <option value="bar">Bar Chart</option>
                  <option value="line">Line Chart</option>
                  <option value="doughnut">Doughnut Chart</option>
                  <option value="table">Table</option>
                </select>
              </label>
              <label>
                Description
                <textarea name="metricDescription" placeholder="Optional description of the metric"></textarea>
              </label>
              <button type="submit" class="primary">Add Metric</button>
            </form>

            <form id="adminRemoveMetricForm" class="admin-form">
              <h3>Remove Metric</h3>
              <label>
                Node
                <select name="removeNodeId" required>
                  <option value="">Select a node...</option>
                </select>
              </label>
              <label>
                Metric
                <select name="metricToRemove" required>
                  <option value="">Select a metric...</option>
                </select>
              </label>
              <button type="submit" class="danger">Remove Metric</button>
            </form>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <section class="relations-section">
    <h2>Relations View</h2>
    <p class="relations-hint">Shows the first version of flows between nodes. Click to navigate.</p>
    <div id="relationView" class="relation-view"></div>
  </section>

  <script src="js/d3.v7.min.js"></script>
  <!-- DEVELOPMENT: Using mock data for frontend-only development -->
    <script src="js/data.js?v=20241220c"></script>
  <!-- PRODUCTION: Uncomment these when deploying with Supabase backend:
  <script type="module" src="js/config.js?v=20241220"></script>
  <script type="module" src="js/supabase.js?v=20241220"></script>
  <script type="module" src="js/data-supabase.js?v=20241220"></script>
  -->
  <script src="js/charts.js?v=20241220b"></script>
    <script src="js/ui.js?v=20241220aa"></script>
  <script src="js/map.js?v=20241220l"></script>
  <script src="js/app.js?v=20241220c"></script>
</body>
</html>
